# 工程开发基础---编码规范
## 声明：
---
> 本课程仅仅对程序员在开发过程中基础编程行为的进行规范，一是用来提高项目开发的可交流性，二是用来提高程序程序设计的质量。对于算法上并不做规范要求。仅作内部交流使用。

## 目录
---
+ 第01章 课程目标
+ 第02章 课程内容
    - 2.1 内容简介
    - 2.2 高质量软件之道
        - 2.1.1 软件质量的定义
        - 2.1.2 高质量软件的属性
        - 2.1.3 为什么要讲高质量软件编程？
        - 2.1.4 软件的调试与测试
    - 2.3 开始高质量软件编程之路
        - 2.2.1 排版
        - 2.2.2 变量、表达式
        - 2.2.3 函数设计
    - 2.4 高质量软件编程进阶之路
        - 2.3.1 内存管理
        - 2.3.2 程序效率
        - 2.3.3 软件后期测试与维护
+ 第03章 课程总结
+ 第04章 课程评价
---
 
## 正文
---

# 第01章 课程目标

软件质量一直都是被程序员挂在嘴边而没有实际行动的一件重要的事情，不论是刚迈入程序员道路的新手，还是正在程序员的道路上行走的老手。

本课程从高质量软件的基础出发，对高质量软件编程进行了介绍。之后对高质量软件编程设计进行了编码规范，通过编程规范进行程序的设计，一方面可以提高编程的效率和高质量的设计，另一方面可以形成良好的编码风格。不仅方便别人阅读自己的代码，还便于交流，提高编程水平。最后对高质量编程的进阶之路进行了简单的介绍。

>> 什么是好的设计？        
>> 1. 好的设计应当恰如其分地反映、解决一个具体的问题，没有不必要的特性；
>> 2. 好的设计应该尽量降低对象之间、模块之间的耦合性。

要想提高编程质量，仅仅通过看书是有限的，要将书上的知识与实际的编码风格结合，逐渐过渡到成熟的编码风格。

# 第02章 课程内容

## 2.1 内容简介
---
本课程第一章对高质量软件编程进行了介绍，解答了为什么要进行高质量编程。第二三章对高质量软件编程之路进行了详细的介绍。通过不断的练习，形成自己的高质量编码风格。最后对课程进行了总结。接下来进入高质量软件编程之路的学习吧！！！

## 2.2 高质量软件编程之道

### 2.2.1 软件质量的定义

### 2.2.2 高质量软件的属性

### 2.2.3 为什么要讲高质量软件编程

### 2.2.4 软件的调试与测试

## 2.3 开始高质量软件编程之路

### 2.3.1 排版

* #### 1. 文件结构

    每个C/C++程序通常分为两类文件，一类文件用于保存程序的声明，称为头文件；另一类文件用于保存程序的实现，称为源文件。

    C/C++程序的头文件以`.h`为后缀，C程序的源文件以`.c` 为后缀，C++程序的源文件以`.cpp`为后缀。

    C/C++编译器在读取到一条函数调用语句时首先应当知道该函数的原型和定义，函数原型一般都放在头文件中，函数定义放在源文件中，当编译器在源文件中读取到`#include`指令包含另一个头文件的时候，编译预处理器用头文件的内容取代`#include`指令，最后头文件的所有内容会被合并到某一个或几个源文件中。

    * #### 版权声明
        ~~~
        为什么要在头文件和源文件前加入版权和版本信息？
        如果你在企业工作，请记住：你已经不是学生了，你工作期间编写的一切代码都是属于企业的，所以要给每个程序打上企业的“名号”，即版权和版本声明。
        ~~~

        版权、版本信息的主要内容有：
        
        1. 版权信息；
        2. 文件名称，标识符，摘要；
        3. 当前版本号，作者/修改者，完成日期；
        4. 版本历史信息。

        格式参考入下：
        ```
        /**************************************************
        * Copyright (c) 2017,北京中科浩电科技有限公司研发部
        * All rights reserved.
        *
        *
        * 文件名称： filename.h
        * 文件标识： 见配置管理计划书
        * 摘    要： 简要描述本文件的内容、功能
        *
        * 
        * 当前版本： 1.1
        * 作    者： 输入作者（或修改者）名字
        * 完成日期： ***年**月**日
        * 修改说明：
        *
        * 取代版本：1.0
        *  原作者 ： 输入原作者（或修改者）名字
        * 完成日期： ***年**月**日
        * 原版本说明：
        *
        **************************************************/
        ```

    * #### 头文件的结构与作用

        * #### 头文件的作用：
        
        1. 通过头文件来调用库函数。用户只要按照头文件中的接口声明来调用库函数，不必关心接口的实现；
        2. 头文件能加强类型安全检查，如果出现函数实现或使用时的方式与头文件中的声明不一致，编译器会指出错误；
        3. 提高程序的可读性。

        * #### 头文件的结构：
        
        **[规则2-3-1-1]** 为了防止头文件被重复引用，应当用 `ifndef/define/endif` 结构产生预处理块。
        
        **[规则2-3-1-2]** 用 `#include <filename.h>` 格式来引用标准库的头文件（编译器将从标准库目录开始搜索）。
        
        **[规则2-3-1-3]** 用 `#include “filename.h” `格式来引用非标准库的头文件（编译器将从用户的工作目录开始搜索）。

        结构如下：
         
        > 1. 头文件的注释(包括文件说明、功能描述、版权声明等)。
        > 2. 内部包含“卫哨开始”(`#ifdef 头文件名大写`、`#define 头文件名大写`)
        > 3. `#include`其他头文件 (如果需要)
        > 4. 外部变量、全局函数声明 (如果需要)
        > 5. 常量、宏定义 (如果需要)
        > 6. 类型前置声明、定义 (如果需要)
        > 7. 全局函数原型和内联函数的定义 (如果需要)
        > 8. 内部包含“卫哨结束” `#endif`
        > 9. 文件版本及修订说明  

        格式参考如下：
        ```
        #ifndef GRAPHICS_H // 防止 graphics.h 被重复引用
        #define GRAPHICS_H
        #include <math.h>  // 引用标准库的头文件
        …
        #include “myheader.h” // 引用非标准库的头文件
        …
        void Function1(…); // 全局函数声明
        …
        class Box // 类结构声明
        {
            …
        };
        #endif
        ```
    * #### 源文件的结构

        C/C++源文件用来保存函数的实现和类的实现，其结构如下：
        > 1. 源文件注释(包括文件说明、功能描述、版权声明等等)
        > 2. 预处理指令
        > 3. 常量 、宏定义
        > 4. 外部变量声明、全局变量定义及初始化
        > 5. 成员函数和全局函数的定义
        > 6. 文件修改记录

    上述头文件、源文件的结构可根据实际情况灵活安排。 

* #### 2. 程序文件目录结构
    一个正在开发的程序工程不仅包含源代码文件，还包含许多资源文件、数据文件、库文件及配置文件等等，为了方便于开发与维护，我们需要有个一目了然的目录结构。例如，我们创建一个C/C++程序工程TestProj，其程序目录结构可以参照图2-1上所示。

    **图2-1 程序目录结构参照图**：

    ![程序目录结构](程序目录参照结构.png "程序目录结构")

    图2-1说明：
    > 1. **Include**存放程序的头文件(`.h`),还可以添加子文件。
    > 2. **Source**存放程序的源文件(`.c .cpp`)，还可以添加子文件。。
    > 3. **Shared**存放一些共享的文件。
    > 4. **Resource**存放程序所用的各种资源文件，还可以添加子文件。
    > 5. **Debug**存放程序发行版本生成的中间文件。
    > 6. **Bin**存放程序员自己创建的lib文件或dll文件。

* #### 3. 程序版式

    版式虽然不会影响程序的功能，但是会影响程序的可读性和清晰性。可以使维护人员明了程序的内容。

    * #### 空行
    >> 空行起着分隔程序段落的作用。使用得当使得程序的布局更加清晰。
    
    **[规则2-3-3-1]** 在每个类声明之后、每个函数定义结束之后都要加空行。
    
    **[规则2-3-3-2]** 在一个函数体内，逻揖上密切相关的语句之间不加空行，其它地方应加空行分隔。

    实例：
    ~~~
    // 空行
    void Function1(…)
    {
        …
    }
    // 空行
    void Function2(…)
    {
        …
    }

    // 空行
    while (condition)
    {
        statement1;
        // 空行
        if (condition)
        {
            statement2;
        }
        // 空行
        statement4;
    }
    ~~~
    
    * #### 代码行
    
    **[规则2-3-3-3]** 一行代码只做一件事情，如只定义一个变量，或只写一条语句。这样的代码容易阅读，并且方便于写注释。

    **规则[2-3-3-4]** `if、for、while、do` 等语句自占一行，执行语句不得紧跟其后。不论执行语句有多少都要加{}。这样可以防止书写失误。

    **[规则2-3-3-5]**尽可能在定义变量的同时对变量进行初始化。(就近原则)

    实例：
    ~~~
    int width = 10;  // 宽度
    int height = 10; // 高度
    int depth = 10;  // 深度
    //空行
    x = a + b;
    y = c + d;
    z = e + f;
    //空行
    if (width < height)
    {
        dosomething();
    }
    //空行
    for (initialization; condition; update)
    {
        dosomething();
    }
    // 空行
    other();
    ~~~

    * #### 代码行内空格
    >> 说明：采用这种松散方式编写代码的目的是使代码更加清晰

    **[规则2-3-3-6]** 关键字之后要留空格。比如 `const、virtual、inline、case` 等关键字之后至少要留一个空格，否则无法辨析关键字;`if、for、while` 等关键字之后应留一个空格再跟左括号‘（’，以突出关键字。

    **[规则2-3-3-7]** 函数名之后不要留空格，紧跟左括号‘（’，与关键字区别。

    **[规则2-3-3-8]**  左括号‘（’向后紧跟，右括号‘）’、逗号‘，’、分号‘;’向前紧跟，紧跟处不留空格。

    **[规则2-3-3-9]** 逗号‘，’之后要留空格，比如 `Function(x, y, z)`。如果分号‘;’不是一行的结束符号，其后要留空格，比如 `for 空格(initialization; condition; update)`。

    **[规则2-3-3-10]** 赋值操作符、比较操作符、算术操作符、逻辑操作符、位域操作符，比如“=”、“+=”、“>=”、“<=”、“+”、“-”、“*”、\*/\*、“%”、“&&”、“||”、“<<”,“^”等二元操作符的前后应当加空格。

    **[规则2-3-3-11]** 单目操作符如“!”、“~”、“++”、“--”、“&”（地址运算符）等前后不加空格。

    **[规则2-3-3-12]** 比如 中括号“［］”、小数点“.”、立即操作符“->”这类操作符前后不加空格。

    **[规则2-3-3-13]** 修饰符 * 和 & 应当紧靠进变量名。
    >>说明：若将修饰符 * 靠近数据类型,从语法上来讲比较符合，但容易引起误解。比如：`int* x, y;` 此处 `y` 容易被误解为指针变量。

    **建议：** 对于表达式比较长的 `for` 语句和 `if `语句，为了紧凑起见可以适当地去掉一些空格，如 `for (i=0; i<10; i++)和 if ((a<=b) && (c<=d))`

    示例：
    ~~~
    void Func(int a, int b, int c);
    
    if (min > 1000)
    if ((a >= b) && (b < c>))

    for (i = 0; i < 100; i++)

    x = (a < b) ? a : b;

    int *p = &x;
    array[6] = {0}; 
    a.Func();
    b->Func();

    int *x, y;                   //变量y不会被误解为指针变量
    ~~~

    * #### 对齐

    **[规则2-3-3-14]** 程序的分界符 ‘{’ 和 ‘}’ 应**独占一行并且位于同一列**，同时与引用它们的语句左对齐。

    **[规则2-3-3-15]** { }之内的代码块在 ‘{’ 右边数格处**左对齐**。

    示例：
    ~~~
    void Function(int x)
    {
        …     // program code
    }
    //空行
    if (condition)
    {
        …    // program code

    }else
    {
        …   // program code
    }
    //空行
    如果出现嵌套的｛｝，则使用缩进对齐，如：
    {
        …
        
        {
            …
        }
        
        …
    }
    ~~~
    
    * #### 长行拆分

    **[规则2-3-3-16]** 代码行最大长度宜控制在 70 至 80 个字符以内。

    **[规则2-3-3-17]** 较长的语句（ >80 字符）要分成多行书写，长表达式要**在低优先级操作符处划分新行，操作符放在新行之首**，划分出的新行要进行适当的缩进，使排版整齐。

    **[规则2-3-3-18]** 循环、判断等语句中若有较长的表达式或语句，则要进行适应的划分，**长表达式要在低优先级操作符处划分新行，操作符放在新行之首**。

    示例：
    ~~~
    perm_count_msg.head.len = NO7_TO_STAT_PERM_COUNT_LEN 
                            + STAT_SIZE_PER_FRAM * sizeof( _UL );

    act_task_table[frame_id * STAT_TASK_CHECK_NUMBER + index].occupied 
                    = stat_poi[index].occupied;

    if ((very_longer_variable1 >= very_longer_variable12)
        && (very_longer_variable3 <= very_longer_variable14)
        && (very_longer_variable5 <= very_longer_variable16))
    {
        dosomething();
    }

    for (very_longer_initialization;
        very_longer_condition;
        very_longer_update)
    {
        dosomething();
    }
    ~~~

    * #### 类的版式

    >> 类可以将数据成员和成员函数封装在一起，其中成员函数表示了类的行为（或称服务）。类提供关键字 `public、protected` 和 `private`，分别用于声明哪些数据成员和成员函数是公有的、受保护的或者是私有的。这样可以达到信息隐藏的目的。

    类的版式有两种：

    1.  将` private` 类型的数据写在前面，而将 `public` 类型的函数写在后面，采用这种版式的程序员主张类的设计“以数据为中心”，重点**关注类的内部结构**。
    2. 将 `public` 类型的函数写在前面，而将 `private` 类型的数据写在后面，采用这种版式的程序员主张类的设计“以行为为中心”，重点**关注的是类应该提供什么样的接口**（或服务）。

    **建议:** 采用“以行为为中心”的书写方式，即首先考虑类应该提供什么样的函数。——“这样做不仅让自己在设计类时思路清晰，而且方便别人阅读。

* #### 4. 注释
    C 语言的注释符为“/*…*/”。C++语言中，程序块的注释常采用“/*…*/”，行注释
    一般采用“//…”。注释通常用于：
    + 版本、版权声明；
    + 函数接口说明；
    + 重要的代码行或段落提示。
    
    一般情况下，源程序有效注释量必须在 0~20%以上。
    >> 说明：注释的原则是有助于对程序的阅读理解，在该加的地方都加了，注释不宜太多也不能太少，注释语言必须准确、易懂、简洁。

    **[规则2-3-4-1]** **边写代码边注释，修改代码同时修改相应的注释**，以保证注释与代码的一致性。不再有用的注释要删除。
    
    **[规则2-3-4-2]** (针对企业) **说明性文件头部应进行注释**，注释必须列出：版权说明、版本号、生成日期、作者、内容、功能、与其它文件的关系、修改日志等，头文件的注释中还应有函数功能简要说明。

    示例：
    ~~~
    /********************************************************
    版权说明     
    File Name：               //文件名
    Author：         Version：          Date：        //作者、版本号、日期
    Description：     //描述此程序文件完成的主要功能，
                     //与其他模块或函数的接口，输出值、取值范围、含义
                     //及参数间的控制、顺序、独立或依赖关系
    Others:          //其他内容的说明  
    Function List：  //主要函数列表，每条记录包含函数名及其功能简要说明。
    1....
    History：       //修改历史记录，包括修改时间、修改人及修改内容简述。
    1. date：
        Author：
        Modification：
    2. .....

    *******************************************************/
    ~~~

    **[规则2-3-4-3]**(针对企业) 源文件头部进行注释，列出：版权说明、版本号、生成日期、作者、模块功能、主要函数其功能、修改日志等。

    示例：
    ~~~
    ~~~

    **[规则2-3-4-4]** 函数头部进行注释，列出：函数的功能、输入参数、输出参数、返回值、调用关系(函数、表)等。

    示例：
    ~~~

    ~~~

* #### 5. 命名规则

    * #### 标识符的命名

    * #### 常量、变量的命名
    
    * #### 函数的命名

    * #### 接口的命名

    * #### 宏定义的命名

### 2.3.2 变量、表达式

### 2.3.3 函数设计

* #### 参数的规则

* #### 返回值的规则

* #### 内部实现的规则

* #### 函数功能的规则

* #### 其他

## 2.4 高质量软件编程进阶之路

### 2.4.1 内存管理

* #### 内存分配方式

* #### 常见的内存错误及对策

* #### 杜绝“野指针”

* #### 三种传参方式

### 2.4.2 程序效率

### 2.4.3 软件后期的调试与测试

# 第03章 课程总结

# 第04章 课程评价