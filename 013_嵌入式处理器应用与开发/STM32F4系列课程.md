# STM32课程 — 基于F429I-DISCO

## 声明：本课程仅供内部参考。

# 课程目标

## 目录
---
+ 第01章 初始STM32
    - 1.1 为什么学习STM32
    - 1.2 如何学习STM32
    - 1.3 STM32库开发 
    - 1.4 Cortex-M4处理器简介
    - 1.5 STM32F4××x系列简介
        - 1.2.1 STM32F429I-DISCO原理图
        - 1.2.2 STM32F429I-DISCO芯片解读

+ 第02章 开发工具
    - 2.1 keil-MDK工具简介
    - 2.2 keil-MDK的安装与工程的建立
    - 2.3 ST-Link/V2仿真调试器

+ 第03章 电路基础知识概述
    - 3.1 电子元器件综述
    - 3.2 常用电子元器件 

+ 第04章 STM32驱动开发
    - 4.1 STM32F429I-DISCO开机测试
    - 4.2 STM32---GPIO工作原理
    - 4.3 STM32---时钟系统
    - 4.4 中断与定时器
    - 4.5 串口通信

+ 第05章 STM32进阶之路
    - 5.1 QVGA TFT 液晶屏显示实验
    - 5.2 传感器L3GD20陀螺仪实验
---

# 第01章 初始STM32

本课程第01章将与大家共同探讨我们为什么要学习STM32以及如何学习STM32。本章将帮助初学者快速的理解STM32，从软件工程的角度深入剖析什么是固件库、为什么使用固件库和如何使用。

从什么是STM32到Cortex-M4处理器简介出发，理解STM32的内部工作原理，最后对我们使用的STM32F429I-DISCO进行初步的介绍。只要你有决心和耐心你就可以掌握单片机这门技术。

## 1.1 为什么学习STM32？

STM32系列芯片是由ST(意法半导体)公司基于ARM公司的Cortex-M3内核开发的32位微控制器(MCU)，采用库开发的方式快速的通过调用库中的API(应用程序接口)，就可以迅速搭建一个大型的程序。

在嵌入式领域STM32芯片介于低端和高端之间，相对于普通的8/16位单片机有更多的片上外设，更先进的内核结构，可以运行μC/OS、free RTOS等实时操作系统，相对于可运行Linux操作系统的高端CPU，其成本低，实时性强。STM32凭借其产品线的多样化、极高的性价比、简单易用的开发方式，迅速占领了中低端市场，被很多企业所认可。

## 1.2 如何学习STM32？

因为STM32的开发方式较传统8/16位单片机开发有很大的不同，所以学习时应该注意以下几点：

1. 转变思维，传统的8/16位单片机是通过配置寄存器来实现相应的功能，而STM32是通过调用库函数来实现。应当尽快的适应固件库的开发方式，加强运用C语言的能力，建立工程意识。

2. 熟悉Cortex-M系列芯片的架构，了解CMSIS标准，熟悉STM32的总线架构。

3. 掌握I2C、SPI、SDIO、CAN、TCP/IP等各种通信协议，掌握了这些协议，开发软件驱动就变得相对容易了。 

## 1.3 STM32库开发

### 1.3.1 什么是STM32库？

STM32库是由ST公司针对STM32提供的函数接口(API)，开发者通过调用函数接口来配置STM32的寄存器，使得开发者脱离最底层的寄存器操作。当我们调用库中的API时，不用去了解底层的寄存器操作，只需拿过来使用就行。

实际上，库是架设在寄存器与用户驱动层之间的代码，向下处理与寄存器直接相关的配置，向上为开发者提供配置寄存器接口。

库开发方式与直接配置寄存器方式区别如下图1-1：

<div align = "center">

![图1-1 开发方式对比图](http://img0.ph.126.net/Mjvn_TOsAudaCEsDBfKe6Q==/6632324507492236527.png "开发方式对比")

图1-1 开发方式对比图
</div>

### 1.3.2 为什么使用库开发

STM32的外设资源丰富，就会带来寄存器的数量和复杂程度增加，直接配置寄存器方式的缺陷就非常的明显：

> 1. 开机速度慢；
> 2. 程序可读性差。

这两个缺陷会直接影响开发效率低，程序的维护成本高，还不便于交流，而相反库开发方式正好弥补了这两个缺陷。但相对于库开发的方式，直接配置寄存器方式生成的代码量会少一点，不过STM32有充足的资源，权衡利弊，我们还是选择库开发方式更好一点。 当然，库函数的底层实现就是直接配置寄存器的方式，如果想要更加深入的了解芯片的工作原理，只要追踪到库的最底层实现就能够理解。

库的本质就是建立了一个新的软件抽象层，分层的思想能力屏蔽底层实现方式的差异，使得软件开发变成简单的调用函数接口，而不用管它的内部实现，大大提高效率。

那我们为什么使用库函数开发呢？在回答之前请思考如下问题：

>>  为什么采用C语言开发软件而不是直接使用汇编语言呢？

如表1-1和表1-2所示，通过对比就可以发现调用库接口开发与直接配置寄存器开发的关系。

<div align = "center">

表1-1 c语言与库函数开发方式

![c语言与库函数开发方式](http://img0.ph.126.net/AebCvU2hub7pgsLd4ZzxtQ==/1278177869261664441.png "c语言与库函数开发方式")

表1-2 汇编与直接配置寄存器开发方式

![汇编与直接配置寄存器开发方式](http://img0.ph.126.net/iztihYRDHJug2zcP893NMg==/2596043710220971542.png "汇编与直接配置寄存器开发方式")

</div>

## 1.3 Cortex-M4处理器简介

### 1.3.1 Cortex-M4内部架构

Cortex是ARM公司最新系列的处理器内核名称，其目的是为当前市场提供一个标准的处理器架构，Cortex系列处理器内核作为一个完整的处理器核心，除了向用户提供标准CPU处理核心外，还提供了标准的硬件系统架构。STM32微控制器是基于“M”分支的Cortex-M系列内核，是专门为实现系统高性能与低功耗并存而设计的。

Cortex-M4处理器基于ARMv7-M架构(使用32位架构)，寄存器组中的内部寄存器、数据通路以及总线接口都是32位的，Cortex-M处理器使用的指令集架构(ISA)为Thumb ISA，其基于Thumb-2技术并同时支持16位和32位指令。

如下图1-2所示为Cortex-M4的内部架构：

<div align = "center">

![Cortex-M4内部架构](http://img0.ph.126.net/vY8XPhqG_lzqxc5Ed0UKMg==/2605050909475699476.png "Cortex-M4内部架构")

图1-2 Cortex-M4内部架构(虚线框表示可选配部分)

</div>

* Cortex-M4处理器具有以下特点：

    > * 三级流水线设计。
    > * 哈佛总线架构，且具有统一的存储器空间：指令和地址总线使用相同的地址空间；
    > * 32位寻址，支持4GB存储器空间；
    > * 基于ARM AMBA(高级微控制器总线架构)技术的片上接口，支持高吞吐量的流水线总线操作；
    > * 名为NVIC(嵌套向量中断控制器)的中断控制器，支持最多240个中断请求和8~256个中断优先级；
    > * 支持可选的MPU(存储器保护单元),提供了可编程存储器或访问权限控制等存储器保护特性；
    > * 通过位段特性支持两个特定存储器区域中的位数据访问；> * 支持多种OS(操作系统)特性，如：节拍定时器以及影子栈指针等。 

* Cortex-M4处理器提供多种指令：

    > * 普通数据处理，包括硬件除法指令；
    > * 存储器访问指令，支持8位、16位、32位、64位数据，以及其他可以传输多个32位数据的指令；
    > * 位域处理指令；
    > * 乘累加(MAC)以及饱和指令；
    > * 用于跳转、条件跳转以及函数调用的指令；
    > * 用于系统控制、支持OS等指令；
    > 
    >> 另外支持：
    > 
    > * 单指令多数据(SIMD)操作；
    > * 其他快速MAC和乘法指令；
    > * 饱和运算指令；
    > * 可选的浮点指令(单精度)。 

1.3.2 Cortex-M4内核模块

如下图1-3所示为Cortex-M4的内核模块框图：

<div align = "center">

![Cortex-M4内部模块框图](http://img1.ph.126.net/mN4tKzn6GTSLdEENn-d2lQ==/6632460846934080307.png "Cortex-M4内部模块框图")

图1-4 Cortex-M4内部模块框图
</div>

Cortex-M4内核模块框图说明：

 > * 核心处理器：中央内核(包含DSP)、1.25 DMIPS/MHz、Thumb-2、单周期MAC、带可选配的单精度浮点运算单元
 > * NVIC 嵌套向量中断控制器--可配置的中断控制器
 >   - 1:240 中断 -中断的具体路数由芯片厂商定义
 >   - 采用向量中断的机制，自动取出对应的服务例程入口地址，无需软件判定
 >   - 支持中断嵌套
 >   - 1:255 优先级
 >   - NMI & SysTick
 > * SysTick定时器
 >   - 倒计时定时器，用于在每隔一定的时间产生一个中断
 >   - 系统睡眠模式下也可工作
 >   - OS系统心跳定时
 > * Wake-up中断控制器
 >   - 可配置
 >   - 为低功耗模式提供唤醒功能
 >   - 隔离不同的供电区域

## 1.4 STM32F4××x系列简介

STM32F4系列产品概览如下图1-5和图1-6所示：

<div align = "center">

![STM32F4系列产品概览](http://img1.ph.126.net/_qxPUYm70Eux1AEpd6fRCQ==/6632723630210522452.png "STM32F4系列产品概览")

图1-5 STM32F4系列产品概览

![STm32F4系列产品外设组合](http://img2.ph.126.net/6zihxyGeoj6hJ6ThP9aFLA==/94012642239939137.png  "STm32F4系列产品外设组合")

图1-6 STM32F4系列产品外设组合

</div>



### 1.4.1 STM32F429I-DISCO原理图

### 1.4.2 STM32F429I-DISCO芯片解读

# 第02章 开发工具

## 2.1 keil-MDK工具简介

## 2.2 keil-MDK的安装与工程的建立

## 2.3 ST-Link/V2仿真调试器

# 第03章 电路基础知识概述

## 3.1 电子元器件综述

## 3.2 常用电子元器件 

# 第04章 STM32驱动开发

## 4.1 STM32F429I-DISCO开机测试

## 4.2 STM32---GPIO工作原理

## 4.3 STM32---时钟系统

## 4.4 中断与定时器

## 4.5 串口通信

# 第05章 STM32进阶之路
   
## 5.1 QVGA TFT 液晶屏显示实验

## 5.2 传感器L3GD20陀螺仪实验

# 课程总结

# 课程评价 



















